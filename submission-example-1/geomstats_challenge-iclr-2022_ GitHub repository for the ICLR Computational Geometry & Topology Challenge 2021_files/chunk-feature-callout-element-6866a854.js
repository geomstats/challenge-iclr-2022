System.register(["./chunk-vendor.js","./chunk-frameworks.js"],function(){"use strict";var n,l,u,m,f;return{setters:[function(a){n=a.t,l=a.j,u=a.aj,m=a.c},function(a){f=a.s}],execute:function(){var a=Object.defineProperty,b=Object.getOwnPropertyDescriptor,g=(t,e)=>a(t,"name",{value:e,configurable:!0}),i=(t,e,r,c)=>{for(var o=c>1?void 0:c?b(e,r):e,d=t.length-1,h;d>=0;d--)(h=t[d])&&(o=(c?h(e,r,o):h(o))||o);return c&&o&&a(e,r,o),o};const{getItem:y,setItem:p}=f("localStorage");let s=class extends HTMLElement{constructor(){super(...arguments);this.dismissEvent="click",this.labelClass="new-feature-label"}async connectedCallback(){this.bootstrapFromLocalStorage()||await this.bootstrapFromServer()}bootstrapFromLocalStorage(){const t=y(this.localStorageKey);return t?(this.bootstrap(JSON.parse(t)),!0):!1}get localStorageKey(){return`${s.LocalStoragePrefix}:${this.featureName}`}async bootstrapFromServer(){try{const t=await fetch(this.queryPath,{method:"GET",headers:s.FetchHeaders}),e=await t.text();if(!t.ok)throw new Error(`unexpected response status ${t.status}: '${e}'`);const r=JSON.parse(e);return this.bootstrap(r),r.dismissed&&p(this.localStorageKey,e),!0}catch(t){throw new Error(`failed to get feature state from server: ${t}`)}return!1}bootstrap(t){if(!("dismissed"in t)||t.dismissed===null)throw new Error(`malformed response, likely no notice configured: '${JSON.stringify(t)}'`);t.dismissed||(this.applyTargetDefaults(),this.showCallout(),this.dismisser.addEventListener(this.dismissEvent,this.handleDismissal.bind(this),{once:!0}),this.detectAndBindToTabContainer())}detectAndBindToTabContainer(){const t=this.querySelector("tab-container");t&&t.addEventListener("tab-container-changed",e=>{const r=e;r.detail&&r.detail.relatedTarget&&r.detail.relatedTarget.getAttribute("aria-labelledby")===this.dismisser.id&&this.handleDismissal()})}applyTargetDefaults(){if(!this.firstElementChild||this.labelee&&this.dismisser)return;let t=this.firstElementChild.getAttribute("data-target")||"";this.labelee||(t=t.concat(" feature-callout.labelee")),this.dismisser||(t=t.concat(" feature-callout.dismisser")),this.firstElementChild.setAttribute("data-target",t)}handleDismissal(){this.submitForm(),p(this.localStorageKey,'{"dismissed":true}')}showCallout(){this.labelee.classList.add(this.labelClass)}async submitForm(){const t=this.dismissalForm;if(!!t)try{const e=await fetch(t.action,{method:t.method,body:new FormData(t),headers:s.FetchHeaders});if(!e.ok)throw new Error(`unexpected response status ${e.status}: ${await e.text()}`)}catch(e){throw new Error(`failed to persist dismissal to server: ${e}`)}}};g(s,"FeatureCalloutElement"),s.LocalStoragePrefix="feature-callout",s.FetchHeaders={"X-Requested-With":"XMLHttpRequest"},i([n],s.prototype,"labelee",2),i([n],s.prototype,"dismisser",2),i([n],s.prototype,"dismissalForm",2),i([l],s.prototype,"queryPath",2),i([l],s.prototype,"featureName",2),i([l],s.prototype,"dismissEvent",2),i([l],s.prototype,"labelClass",2),i([u(1,{once:!0})],s.prototype,"handleDismissal",1),s=i([m],s)}}});
//# sourceMappingURL=chunk-feature-callout-element-93353e13.js.map
